import{N as U,O as A,o as R,e as m,g,B as y,k as o,F as j,h as Q,n as V,t as N,y as H,q as C,s as x,p as z,P as W,Q as K,d as h,i as u,w as b,x as B,z as P,f as L,j as q,b as X,E as Y,r as D,R as Z,u as ee,A as te,S as le}from"./index-DlEFUHLL.js";import{_ as I,u as F,d as w}from"./index-CEVRakId.js";import{a as oe,b as ae,p as ne}from"./pageTitle-PNUMLZpy.js";const G=e=>(C("data-v-3440c1f9"),e=e(),x(),e),se={class:"module-select-box"},ie={key:0,class:"module-list"},ce=G(()=>o("div",{class:"title"},"基础",-1)),de={class:"flex base-module-box"},ue=["onClick"],re=G(()=>o("div",{class:"title"},"全局",-1)),me={class:"flex global-module-box"},pe={__name:"materialPanel",emits:["add","global"],setup(e,{emit:r}){const{materialDatas:l}=F(),a=r,t=U("baseInfo"),s=A(()=>Object.keys(l).filter(d=>!["advert","tabbar"].includes(d)));return R(async()=>{if(Object.keys(l).some(i=>!l[i].title))for(const i in l){let d=(await l[i].getDefaultConfig()).default;l[i].title=d.title,l[i].defConfig=d,delete l[i].getDefaultConfig}}),(i,d)=>(m(),g("div",se,[["BOTTOM_MENU","HOME_ADVERT"].includes(y(t).category)?H("",!0):(m(),g("div",ie,[ce,o("div",de,[(m(!0),g(j,null,Q(s.value,(v,p)=>(m(),g("p",{class:V({"btn-item":!0,selected:!1}),onClick:$=>a("add",y(l)[v])},N(y(l)[v].title),9,ue))),256))]),re,o("div",me,[o("p",{class:V({"btn-item":!0,selected:!1}),onClick:d[0]||(d[0]=v=>a("global"))},"全局设置")])]))]))}},ve=I(pe,[["__scopeId","data-v-3440c1f9"]]),J=e=>(C("data-v-358a495f"),e=e(),x(),e),fe={class:"diy-phone"},ge=J(()=>o("div",{class:"phone-head"},null,-1)),_e=J(()=>o("div",{class:"phone-icon"},null,-1)),be={__name:"renderEngine",props:{pageConfig:Object},emits:["select"],setup(e,{emit:r}){const l=r;return(a,t)=>(m(),g("div",fe,[o("div",{class:"text-overflow phone-title",onClick:t[0]||(t[0]=s=>l("select"))},[ge,_e,z(" "+N(e.pageConfig.templateTitle),1)]),o("div",{class:"custom-scroll-bar phone-body",style:K({"background-color":e.pageConfig.backgroundColor})},[W(a.$slots,"default",{},void 0,!0)],4)]))}},he=I(be,[["__scopeId","data-v-358a495f"]]),k=e=>(C("data-v-02575c21"),e=e(),x(),e),ye=k(()=>o("div",{class:"module-edit-title"},"页面设置",-1)),Ce=k(()=>o("p",{class:"tips-info"},"注意：页面名称是便于后台查找。",-1)),xe=k(()=>o("div",{class:"tips-info",style:{margin:"-10px 0 10px 78px"}},"建议尺寸256 * 414 (大小建议不超过800k，以免影响加载速度)",-1)),Ie=k(()=>o("div",{class:"diy-edit-line"},null,-1)),$e={__name:"pageSet",props:{config:Object},setup(e){const r=e,l=()=>Bus.emit("selectImage",a=>r.config.images=a.url);return(a,t)=>{const s=h("el-input"),i=h("configItem"),d=h("selectColor"),v=h("el-image");return m(),g("div",null,[ye,u(i,{label:"页面名称",style:{"margin-bottom":"20px"}},{default:b(()=>[u(s,{class:"flex-full",maxlength:12,modelValue:e.config.templateName,"onUpdate:modelValue":t[0]||(t[0]=p=>e.config.templateName=p),placeholder:"请输入页面名称"},null,8,["modelValue"]),Ce]),_:1}),u(i,{label:"页面标题"},{default:b(()=>[u(s,{class:"flex-full",modelValue:e.config.templateTitle,"onUpdate:modelValue":t[1]||(t[1]=p=>e.config.templateTitle=p),placeholder:"请输入页面标题"},null,8,["modelValue"])]),_:1}),u(i,{label:"页面背景"},{default:b(()=>[u(d,{modelValue:e.config.backgroundColor,"onUpdate:modelValue":t[2]||(t[2]=p=>e.config.backgroundColor=p),resetColor:"#ededed"},null,8,["modelValue"])]),_:1}),u(i,{label:"封面图",isRequire:!0},{default:b(()=>[o("div",{class:"upload-image",onClick:l},[B(u(v,{src:e.config.templateImg},null,8,["src"]),[[P,e.config.templateImg]]),B(o("span",null,"+",512),[[P,!e.config.templateImg]])])]),_:1}),xe,Ie])}}},Te=I($e,[["__scopeId","data-v-02575c21"]]),M=e=>(C("data-v-e132c8d9"),e=e(),x(),e),ke={class:"diy-edit-box"},Me={class:"edit-config-box"},Ee={class:"header-info"},Oe={class:"title"},Se=M(()=>o("span",{class:"iconfont icon-fuzhi1"},null,-1)),De=M(()=>o("span",null,"复制",-1)),we=[Se,De],Ve=M(()=>o("span",{class:"iconfont icon-shanchu2"},null,-1)),Ne=M(()=>o("span",null,"删除",-1)),Be=[Ve,Ne],Pe={class:"edit-config-done"},Ue={__name:"configPanel",props:{activeItem:Object},emits:["copy","delete","submit"],setup(e,{emit:r}){const l=r,a=U("baseInfo");return(t,s)=>{const i=h("el-button");return m(),g("div",ke,[o("div",Me,[o("div",Ee,[o("p",Oe,N(e.activeItem.title),1),y(a).category!=="BOTTOM_MENU"?(m(),g(j,{key:0},[o("p",{class:"pointer btn",onClick:s[0]||(s[0]=d=>l("copy"))},we),o("p",{class:"pointer btn",onClick:s[1]||(s[1]=d=>l("delete"))},Be)],64)):H("",!0)]),(m(),L(q(e.activeItem.configComponent||Te),{class:"custom-scroll-bar edit-config-module",config:e.activeItem.config},null,8,["config"]))]),o("div",Pe,[u(i,{type:"primary",onClick:s[2]||(s[2]=d=>l("submit"))},{default:b(()=>[z("保存")]),_:1})])])}}},Ae=I(Ue,[["__scopeId","data-v-e132c8d9"]]),{materialDatas:Re}=F();function je(e,r,l){return X(),{initData:async(s,i)=>{if(e.value.id=i,e.value.category=s,!i)if(["BOTTOM_MENU","HOME_ADVERT"].includes(s)){const c={BOTTOM_MENU:[{name:"tabbar"}],HOME_ADVERT:[{name:"advert"}]};r.value=c[s].map(f=>{let _=Re[f.name];return _.config=Object.assign({},_.defConfig,f.config||{}),_}),l.value=0;return}else return;let{category:d,sourceType:v,templateTitle:p,templateName:$,templateImg:T,backgroundColor:E,searchKey:O,templateConfigParams:S,componentIds:n}=await oe(i);r.value=JSON.parse(S),e.value.category=d,e.value.sourceType=v,e.value.templateName=$,e.value.templateTitle=p,e.value.templateImg=T,e.value.backgroundColor=E,e.value.searchKey=O,e.value.componentIds=n,["BOTTOM_MENU","HOME_ADVERT"].includes(d)&&(l.value=0)},submitData:async()=>{let s={...e.value};s.templateConfigParams=JSON.stringify(r.value),await ae(s),Y({type:"success",message:"保存成功"})}}}const He=e=>(C("data-v-be797ddb"),e=e(),x(),e),ze={class:"wrapper"},Ke={class:"content-box"},Le=He(()=>o("div",{class:"c_line"},null,-1)),qe={__name:"index",setup(e){const r=ee(),l=D({id:"",category:"HOME",sourceType:"MARKET_APPLETS",templateName:"页面名称",templateTitle:"页面标题",templateImg:"https://img0.baidu.com/it/u=3773090653,2338589126&fm=253&fmt=auto&app=138&f=JPEG?w=750&h=500",backgroundColor:"#ffffff",searchKey:"首页",templateConfigParams:"[]",componentIds:""});Z("baseInfo",l.value);const a=D([]),t=D(-1),s=A(()=>a.value[t.value]||{title:"全局设置",isGlobal:!0,config:l.value}),{initData:i,submitData:d}=je(l,a,t),v=n=>{let c=w(n);c.config=w(c.defConfig),t.value===-1?(a.value.push(c),t.value=a.value.length-1):(a.value.splice(t.value+1,0,c),t.value=t.value+1)},p=n=>t.value>=0,$=n=>{t.value=n.newIndex},T=n=>{t.value=n},E=()=>{let n=t.value;if(n===-1)return;let c=w(a.value[n]);a.value.splice(n+1,0,c),t.value+=1},O=async()=>{let n=t.value;if(n===-1)return;await te.confirm("确定删除吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"})==="confirm"&&(a.value.splice(n,1),n>=a.value.length-1&&(t.value=a.value.length-1))},S=()=>{let{type:n}=l.value;d(n)};return R(()=>{let{type:n,id:c=""}=r.query;console.log("type, id",n,c),setTimeout(()=>{i(n,c)},500)}),(n,c)=>(m(),g("div",ze,[u(ne,{title:"编辑"}),o("div",Ke,[u(ve,{activeIndex:t.value,onAdd:v,onGlobal:c[0]||(c[0]=f=>t.value=-1)},null,8,["activeIndex"]),u(he,{pageConfig:l.value,onSelect:c[2]||(c[2]=f=>T(-1))},{default:b(()=>[u(y(le),{style:K({height:l.value.category==="advert"?"100%":"unset"}),modelValue:a.value,"onUpdate:modelValue":c[1]||(c[1]=f=>a.value=f),move:p,onUpdate:$,"item-key":"index"},{item:b(({element:f,index:_})=>[o("div",null,[(m(),L(q(f.componentName),{"item-key":_,class:V({editing:!0,selected:_===t.value}),config:f.config,onClick:Fe=>T(_)},null,8,["item-key","class","config","onClick"]))])]),_:1},8,["style","modelValue"])]),_:1},8,["pageConfig"]),Le,u(Ae,{activeItem:s.value,onCopy:E,onDelete:O,onSubmit:S},null,8,["activeItem"])])]))}},We=I(qe,[["__scopeId","data-v-be797ddb"]]);export{We as default};
